/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var t={908:(t,e,r)=>{var n=r(252).Router(),o=r(46);n.get("/login",(function(t,e){e.render("admin/login")})),n.post("/login",(function(t,e){var r=t.body,n=r.username,o=r.password;n&&o?function(t,e){return"admin"===t&&e===process.env.ADMINPASS}(n,o)?(t.session.user={username:n,role:"admin"},e.redirect("/admin/dashboard")):e.status(401).send("Invalid username or password"):e.status(400).send("Username and password are required")}));var i=function(t,e,r){console.log(t.session),t.session.user&&"admin"===t.session.user.role?r():e.redirect("/")};n.get("/dashboard",i,(function(t,e){e.render("admin/dashboard")})),n.get("/users",i,(function(t,e){o.getAllUsers().then((function(t){e.render("admin/users",{users:t})})).catch((function(t){console.error("Error fetching users:",t),e.status(500).send("Internal Server Error")}))})),n.post("/add-user",i,(function(t,e){var r=t.body,n=r.username,i=r.role;o.insertUserData(n,i).then((function(){e.redirect("/admin/users")})).catch((function(t){console.error("Error adding user:",t),e.redirect("/admin/users")}))})),n.post("/edit-user",i,(function(t,e){var r=t.body,n=r.username,i=r.role;o.updateUserById(n,{username:n,role:i}).then((function(){e.redirect("/admin/users")})).catch((function(t){console.error("Error updating user:",t),e.redirect("/admin/users")}))})),n.post("/delete-user",i,(function(t,e){t.body.userId,o.deleteUserById(username).then((function(){e.redirect("/admin/users")})).catch((function(t){console.error("Error deleting user:",t),e.redirect("/admin/users")}))})),t.exports=n},46:(t,e,r)=>{function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function o(){"use strict";o=function(){return e};var t,e={},r=Object.prototype,i=r.hasOwnProperty,a=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},c=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function f(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{f({},"")}catch(t){f=function(t,e,r){return t[e]=r}}function h(t,e,r,n){var o=e&&e.prototype instanceof w?e:w,i=Object.create(o.prototype),s=new N(n||[]);return a(i,"_invoke",{value:_(t,r,s)}),i}function p(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var d="suspendedStart",y="suspendedYield",v="executing",m="completed",g={};function w(){}function b(){}function E(){}var x={};f(x,c,(function(){return this}));var L=Object.getPrototypeOf,O=L&&L(L(U([])));O&&O!==r&&i.call(O,c)&&(x=O);var T=E.prototype=w.prototype=Object.create(x);function S(t){["next","throw","return"].forEach((function(e){f(t,e,(function(t){return this._invoke(e,t)}))}))}function P(t,e){function r(o,a,s,c){var u=p(t[o],t,a);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==n(f)&&i.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,s,c)}),(function(t){r("throw",t,s,c)})):e.resolve(f).then((function(t){l.value=t,s(l)}),(function(t){return r("throw",t,s,c)}))}c(u.arg)}var o;a(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}})}function _(e,r,n){var o=d;return function(i,a){if(o===v)throw Error("Generator is already running");if(o===m){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=j(s,n);if(c){if(c===g)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=v;var u=p(e,r,n);if("normal"===u.type){if(o=n.done?m:y,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=m,n.method="throw",n.arg=u.arg)}}}function j(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,j(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=p(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function I(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function N(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(I,this),this.reset(!0)}function U(e){if(e||""===e){var r=e[c];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(i.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(n(e)+" is not iterable")}return b.prototype=E,a(T,"constructor",{value:E,configurable:!0}),a(E,"constructor",{value:b,configurable:!0}),b.displayName=f(E,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,E):(t.__proto__=E,f(t,l,"GeneratorFunction")),t.prototype=Object.create(T),t},e.awrap=function(t){return{__await:t}},S(P.prototype),f(P.prototype,u,(function(){return this})),e.AsyncIterator=P,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new P(h(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},S(T),f(T,l,"Generator"),f(T,c,(function(){return this})),f(T,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=U,N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(k),!e)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(n,o){return s.type="throw",s.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=i.call(a,"catchLoc"),u=i.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),k(r),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;k(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:U(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}function i(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function a(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?i(Object(r),!0).forEach((function(e){s(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function s(t,e,r){return(e=function(t){var e=function(t){if("object"!=n(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==n(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function c(t,e,r,n,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,o)}var u=r(689).verbose(),l=r(976),f=new u.Database("./data/db.sqlite",(function(t){if(t)throw console.error(t.message),t;console.log("Connected to the SQLite database."),f.run("CREATE TABLE IF NOT EXISTS users (\n            id INTEGER PRIMARY KEY AUTOINCREMENT,\n            username TEXT NOT NULL,\n            role TEXT NOT NULL,\n            email TEXT UNIQUE, \n            password TEXT, \n            spotify TEXT,\n            CONSTRAINT email_unique UNIQUE (email)\n        )",(function(t){if(t)throw console.error("Error creating users table:",t.message),t;console.log("Users table created successfully."),f.get('SELECT * FROM users WHERE role = "admin"',(function(t,e){t?console.error("Error checking admin existence:",t.message):e||h("admin","admin","aayvazy@gmail.com",process.env.ADMINPASS)}))}))}));function h(t,e,r,n){return new Promise((function(o,i){f.run("INSERT INTO users (username, role, email, password, spotify) VALUES (?, ?, ?, ?,?)",[t,e,r,l(n)],(function(t){t?i(t):o(this.lastID)}))}))}function p(t){return new Promise((function(e,r){f.get("SELECT * FROM users WHERE id = ?",[t],(function(t,n){t?r(t):e(n)}))}))}function d(){var t;return t=o().mark((function t(e,r){var n,i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,p(e);case 3:if(!(n=t.sent)){t.next=11;break}return i=a(a({},n),r),t.next=8,y(0,i);case 8:return t.abrupt("return",i);case 11:throw new Error("User not found");case 12:t.next=17;break;case 14:throw t.prev=14,t.t0=t.catch(0),new Error("Error updating user data: "+t.t0.message);case 17:case"end":return t.stop()}}),t,null,[[0,14]])})),d=function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){c(i,n,o,a,s,"next",t)}function s(t){c(i,n,o,a,s,"throw",t)}a(void 0)}))},d.apply(this,arguments)}function y(t,e){return new Promise((function(t,r){var n=e.username,o=e.role,i=e.email,a=e.password,s=e.spotify;f.run("UPDATE users SET username = ?, role = ?, email = ?, password = ?, spotify = ? WHERE username = ?",[n,o,i,l(a),s],(function(e){e?r(e):t()}))}))}t.exports={db:f,addUser:h,getUserById:p,getUserByEmail:function(t){return new Promise((function(e,r){f.get("SELECT * FROM users WHERE username = ?",[t],(function(t,n){t?r(t):e(n)}))}))},getAllUsers:function(){return new Promise((function(t,e){f.all("SELECT * FROM users",(function(r,n){r?e(r):t(n)}))}))},updateUserById:function(t,e){return d.apply(this,arguments)},updateUserInDatabase:y}},268:t=>{"use strict";t.exports=require("body-parser")},818:t=>{"use strict";t.exports=require("dotenv")},252:t=>{"use strict";t.exports=require("express")},959:t=>{"use strict";t.exports=require("express-ejs-layouts")},977:t=>{"use strict";t.exports=require("express-session")},701:t=>{"use strict";t.exports=require("firebase-functions")},976:t=>{"use strict";t.exports=require("md5")},587:t=>{"use strict";t.exports=require("spotify-web-api-node")},689:t=>{"use strict";t.exports=require("sqlite3")}},e={};function r(n){var o=e[n];if(void 0!==o)return o.exports;var i=e[n]={exports:{}};return t[n](i,i.exports,r),i.exports}function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function o(){"use strict";o=function(){return e};var t,e={},r=Object.prototype,i=r.hasOwnProperty,a=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},c=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function f(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{f({},"")}catch(t){f=function(t,e,r){return t[e]=r}}function h(t,e,r,n){var o=e&&e.prototype instanceof w?e:w,i=Object.create(o.prototype),s=new N(n||[]);return a(i,"_invoke",{value:_(t,r,s)}),i}function p(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var d="suspendedStart",y="suspendedYield",v="executing",m="completed",g={};function w(){}function b(){}function E(){}var x={};f(x,c,(function(){return this}));var L=Object.getPrototypeOf,O=L&&L(L(U([])));O&&O!==r&&i.call(O,c)&&(x=O);var T=E.prototype=w.prototype=Object.create(x);function S(t){["next","throw","return"].forEach((function(e){f(t,e,(function(t){return this._invoke(e,t)}))}))}function P(t,e){function r(o,a,s,c){var u=p(t[o],t,a);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==n(f)&&i.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,s,c)}),(function(t){r("throw",t,s,c)})):e.resolve(f).then((function(t){l.value=t,s(l)}),(function(t){return r("throw",t,s,c)}))}c(u.arg)}var o;a(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}})}function _(e,r,n){var o=d;return function(i,a){if(o===v)throw Error("Generator is already running");if(o===m){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=j(s,n);if(c){if(c===g)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=v;var u=p(e,r,n);if("normal"===u.type){if(o=n.done?m:y,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=m,n.method="throw",n.arg=u.arg)}}}function j(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,j(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=p(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function I(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function N(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(I,this),this.reset(!0)}function U(e){if(e||""===e){var r=e[c];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(i.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(n(e)+" is not iterable")}return b.prototype=E,a(T,"constructor",{value:E,configurable:!0}),a(E,"constructor",{value:b,configurable:!0}),b.displayName=f(E,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,E):(t.__proto__=E,f(t,l,"GeneratorFunction")),t.prototype=Object.create(T),t},e.awrap=function(t){return{__await:t}},S(P.prototype),f(P.prototype,u,(function(){return this})),e.AsyncIterator=P,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new P(h(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},S(T),f(T,l,"Generator"),f(T,c,(function(){return this})),f(T,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=U,N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(k),!e)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(n,o){return s.type="throw",s.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=i.call(a,"catchLoc"),u=i.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),k(r),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;k(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:U(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}function i(t,e,r,n,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,o)}r(701),r(818).config();var a=r(252),s=r(959),c=r(268),u=r(977),l=r(908),f=r(587),h=r(46),p=a(),d=new f({clientId:process.env.CLIENT_ID,clientSecret:process.env.CLIENT_SECRET,redirectUri:"http://localhost:5000/callback"});d.clientCredentialsGrant().then((function(t){return d.setAccessToken(t.body.access_token)})).catch((function(t){return console.log("Something went wrong when retrieving an access token",t)})),p.use(s),p.use(c.urlencoded({extended:!0})),p.set("view engine","ejs"),p.set("views",__dirname+"/views"),p.use(a.static(__dirname+"/public")),p.use(u({secret:"your-secret-key",resave:!1,saveUninitialized:!0,cookie:{maxAge:864e5}})),p.use("/admin",l);var y=function(t,e,r){t.session.user?r():e.redirect("/login")};p.get("/",y,(function(t,e){e.render("index",{user:t.session.user})})),p.get("/login",(function(t,e){e.render("login")})),p.get("/auth/spotify",(function(t,e){var r=d.createAuthorizeURL(["user-read-recently-played","playlist-read-private"]);e.redirect(r)})),p.post("/login",(function(t,e){var r=t.body,n=r.username,o=r.password;n&&o?function(t,e){return"admin"===t&&e===process.env.ADMINPASS}(n,o)?(t.session.user={username:n,role:"user"},e.redirect("/")):e.status(401).send("Invalid username or password"):e.status(400).send("Username and password are required")})),p.get("/logout",(function(t,e){t.session.destroy((function(t){t&&console.error("Error logging out:",t),e.redirect("/")}))})),p.get("/callback",function(){var t,e=(t=o().mark((function t(e,r){var n,i,a,s,c,u,l,f,p,y;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.query.code,t.prev=1,t.next=4,d.authorizationCodeGrant(n);case 4:return i=t.sent,a=i.body,s=a.access_token,c=a.refresh_token,d.setAccessToken(s),d.setRefreshToken(c),t.next=10,d.getMe();case 10:return u=t.sent,l=u.body.id,t.next=14,h.getUserByEmail(l);case 14:if(t.sent){t.next=18;break}return t.next=18,h.addUser(l,"user","tmp@email","your_default_password");case 18:return t.next=20,h.getUserByEmail(l);case 20:return f=t.sent,t.next=23,d.getUserPlaylists(l,{limit:10,offset:0});case 23:p=t.sent,y=p.body.items,r.render("index",{user:f,displayName:u.body.display_name,userEmail:u.body.email,publicPlaylists:y}),t.next=32;break;case 28:t.prev=28,t.t0=t.catch(1),console.error("Error retrieving user data:",t.t0),r.status(500).send("Error retrieving user data");case 32:case"end":return t.stop()}}),t,null,[[1,28]])})),function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function s(t){i(a,n,o,s,c,"next",t)}function c(t){i(a,n,o,s,c,"throw",t)}s(void 0)}))});return function(t,r){return e.apply(this,arguments)}}()),p.get("/admin/playlists",y,(function(t,e){e.render("admin/playlists")})),p.post("/admin/playlists/create",y,(function(t,e){var r=t.body.playlistName;d.createPlaylist(t.session.userId,r).then((function(t){e.redirect("/admin/playlists")})).catch((function(t){console.log("Error creating playlist:",t),e.redirect("/admin/playlists")}))})),p.post("/admin/playlists/:playlistId/add",y,(function(t,e){var r=t.body,n=r.playlistId,o=r.songLink;d.addTracksToPlaylist(n,[o]).then((function(t){e.redirect("/admin/playlists")})).catch((function(t){console.log("Error adding song to playlist:",t),e.redirect("/admin/playlists")}))})),p.get("/artist/requests",y,(function(t,e){e.render("artist/requests")})),p.post("/artist/requests/add",y,(function(t,e){var r=t.body;r.playlistId,r.songLink,e.redirect("/artist/requests")})),p.get("/user/playlists",y,(function(t,e){e.render("user/playlists")})),p.get("/user/playlists/:playlistId",y,(function(t,e){var r=t.params.playlistId;e.render("user/playlist",{playlistId:r})})),p.listen(5e3,(function(){return console.log("http://localhost:5000")}))})();